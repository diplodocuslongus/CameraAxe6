<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Intervalometer</title>
		<style>
			body{
				font-family: "arial";
			}
			#container{
				width: 450px;
				height: 650px;
				padding: 12px;
				border: 1px solid #000;
			}
			button{
				padding:12px;
				text-align: left;
				font-size: 20px;
			}
			
			/* The Modal (background) */
			.modal {
				display: none; /* Hidden by default */
				position: fixed; /* Stay in place */
				z-index: 1; /* Sit on top */
				padding-top: 100px; /* Location of the box */
				left: 0;
				top: 0;
				width: 450px; /* Full width */
				height: 100%; /* Full height */
				overflow: auto; /* Enable scroll if needed */
			}

			/* Modal Content */
			.modal-content {
				background-color: #fefefe;
				margin: auto;
				padding: 20px;
				border: 1px solid #888;
				width: 80%;
			}

			/* The Close Button */
			.close {
				color: #aaaaaa;
				float: right;
				font-size: 28px;
				font-weight: bold;
			}

			.close:hover,
			.close:focus {
				color: #000;
				text-decoration: none;
				cursor: pointer;
			}
		</style>
	</head>

	<body>
		<div id="container">
			<h1 style="float:left;">Intervalometer</h1>
			<button style="float:right;margin-top:12px;" onclick="redirectTo('HomePage.html');">Home</button>
			<div style="clear:both;"></div>
			<form id="intervalometerForm" name="intervalometerForm">
				<table style="width:100%;">
					<tr>
						<td style="width:50%;">Start Delay</td>
						<td style="width:50%;">
							<input type="text" name="start_delay" onclick="openTimeBox(this,true,true,true,true,true,true);" value="0:0:0.0.0.0" />
						</td>
					</tr>
					<tr>
						<td>Interval</td>
						<td>
							<input type="text" name="interval" onclick="openTimeBox(this,true,true,true,true,true,true);" value="0:0:0.0.0.0" />
						</td>
					</tr>
					<tr>
						<td>Number of Repeats (0 = Infinite)</td>
						<td>
							<input type="number" name="number_of_repeats" min="0" max="9999" oninput="validateNumber(this,4,true);" onkeypress="return event.charCode >= 48 && event.charCode <= 57" value="0" />
						</td>
					</tr>
					<tr>
						<td style="text-align:center;" colspan="2"><br><br><br><br>
							<button onclick="debugInputs()" type="button">Test Trigger</button>
						</td>
					</tr>
				</table>
			</form>
			<!-- The Modal -->
			<div id="timeboxModal" class="modal">

				<!-- Modal content -->
				<div class="modal-content">
					<span class="close">&times;</span>
					<h3>Setting Time</h3>
					<form id="timeboxForm" name="timeboxForm">
						<table style="width:100%;">
							<tr style="display:none;" id="hours">
								<td style="width:50%;">Hours (0-999)</td>
								<td style="width:50%;">
									<input type="number" name="hours" min="0" max="999" oninput="validateNumber(this,3,false);" onkeypress="return event.charCode >= 48 && event.charCode <= 57" value="0" />
								</td>
							</tr>
							<tr style="display:none;" id="minutes">
								<td>Minutes (0-59)</td>
								<td>
									<input type="number" name="minutes" min="0" max="59" oninput="validateNumber(this,2,false);" onkeypress="return event.charCode >= 48 && event.charCode <= 57" value="0" />
								</td>
							</tr>
							<tr style="display:none;" id="seconds">
								<td>Seconds (0-59)</td>
								<td>
									<input type="number" name="seconds" min="0" max="59" oninput="validateNumber(this,2,false);" onkeypress="return event.charCode >= 48 && event.charCode <= 57" value="0" />
								</td>
							</tr>
							<tr style="display:none;" id="milliseconds">
								<td>Milliseconds (0-999)</td>
								<td>
									<input type="number" name="milliseconds" min="0" max="999" oninput="validateNumber(this,3,false);" onkeypress="return event.charCode >= 48 && event.charCode <= 57" value="0" />
								</td>
							</tr>
							<tr style="display:none;" id="microseconds">
								<td>Microseconds (0-999)</td>
								<td>
									<input type="number" name="microseconds" min="0" max="999" oninput="validateNumber(this,3,false);" onkeypress="return event.charCode >= 48 && event.charCode <= 57" value="0" />
								</td>
							</tr>
							<tr style="display:none;" id="nanoseconds">
								<td>Nanoseconds (0-999)</td>
								<td>
									<input type="number" name="nanoseconds" min="0" max="999" oninput="validateNumber(this,3,false);" onkeypress="return event.charCode >= 48 && event.charCode <= 57" value="0" />
								</td>
							</tr>
							<tr>
								<td style="text-align:center;" colspan="2"><br><br><br><br>
									<input type="hidden" id="boxName" name="boxName" value="">
									<button onclick="saveValues();" type="button">Ok</button>
								</td>
							</tr>
						</table>
					</form>
				</div>

			</div>
		</div>
		<p id="debugText"> - </p>
		
		<script>
			function redirectTo(href) {
				document.location.href=href;
			}
			function debugInputs() {
				document.getElementById("debugText").innerHTML = "Test Trigger";
			}
			function validateNumber(number,maxLength,debugInput) {
				if (number.value.length > maxLength) {
					number.value = number.value.slice(0,maxLength); 
				}
				if (number.value.length > 1 && number.value[0]==0){
					number.value = (number.value).replace("0","");
				}
				if (number.value < 0 || number.value=="") {
					number.value = 0;
				}
				if (+number.value > +number.max) {
					number.value = number.max;
				}
				if(debugInput){
					document.getElementById("debugText").innerHTML = number.value;
				}
			}
			
			// Get the modal
			var modal = document.getElementById('timeboxModal');

			// Get the <span> element that closes the modal
			var span = document.getElementsByClassName("close")[0];

			// When the user clicks the input, open the timebox modal 
			function openTimeBox(box,hours,minutes,seconds,milliseconds,microseconds,nanoseconds) {
				if(hours){
					document.getElementById("hours").style.display = "";
					document.getElementsByName("hours")[0].value=0;
				}else{
					document.getElementById("hours").style.display = "none";
				}
				
				if(minutes){
					document.getElementById("minutes").style.display = "";
					document.getElementsByName("minutes")[0].value=0;
				}else{
					document.getElementById("minutes").style.display = "none";
				}
				
				if(seconds){
					document.getElementById("seconds").style.display = "";
					document.getElementsByName("seconds")[0].value=0;
				}else{
					document.getElementById("seconds").style.display = "none";
				}
				
				if(milliseconds){
					document.getElementById("milliseconds").style.display = "";
					document.getElementsByName("milliseconds")[0].value=0;
				}else{
					document.getElementById("milliseconds").style.display = "none";
				}
				
				if(microseconds){
					document.getElementById("microseconds").style.display = "";
					document.getElementsByName("microseconds")[0].value=0;
				}else{
					document.getElementById("microseconds").style.display = "none";
				}
				
				if(nanoseconds){
					document.getElementById("nanoseconds").style.display = "";
					document.getElementsByName("nanoseconds")[0].value=0;
				}else{
					document.getElementById("nanoseconds").style.display = "none";
				}
				
				document.getElementById("boxName").value = box.name;
				
				loadValues(box,hours,minutes,seconds,milliseconds,microseconds,nanoseconds);
				modal.style.display = "block";
			}
			
			// When the user clicks on OK button, update the box value
			function saveValues(){
				var timeboxForm = document.forms["timeboxForm"];
				var boxValue = "";
				for(i=0; i<timeboxForm.length; i++)
				{
					if(timeboxForm[i].type=="number" && document.getElementById(timeboxForm[i].name).style.display!="none"){
						if(i>0 && boxValue!=""){
							if(timeboxForm[i].name=="minutes" || timeboxForm[i].name=="seconds"){
								boxValue += ":";
							}
							else{
								boxValue += ".";
							}
						}
						boxValue += timeboxForm[i].value;
					}
				}
				document.getElementsByName(document.getElementById("boxName").value)[0].value = boxValue;
				modal.style.display = "none";
			}
			
			// When the user clicks on input field, loads the current field value in timebox against each input fields
			function loadValues(inputField,hours,minutes,seconds,milliseconds,microseconds,nanoseconds){
				var timeArray = {
					"hours" : hours,
					"minutes" : minutes,
					"seconds" : seconds,
					"milliseconds" : milliseconds,
					"microseconds" : microseconds,
					"nanoseconds" : nanoseconds
				};
				var j=0;
				var i=0;
				var inputFieldValue = inputField.value;
				var splitInputField = inputFieldValue.split(/[:.]/);
				for(var key in timeArray){
					if(timeArray[key])
					{
						document.getElementsByName(key)[0].value = splitInputField[j];
						j++;
					}
				}
			}
			
			// When the user clicks on <span> (x), close the modal
			span.onclick = function() {
				modal.style.display = "none";
			}

			// When the user clicks anywhere outside of the modal, close it
			window.onclick = function(event) {
				if (event.target == modal) {
					modal.style.display = "none";
				}
			}
		</script>
	</body>

</html>